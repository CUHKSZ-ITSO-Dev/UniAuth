{
  "schemes": [
      "http",
      "https"
  ],
  "swagger": "2.0",
  "info": {
      "description": "UniAuth 统一认证授权系统 API 文档",
      "title": "UniAuth API",
      "termsOfService": "http://swagger.io/terms/",
      "contact": {
          "name": "UniAuth Team",
          "url": "https://github.com/your-org/UniAuth",
          "email": "support@uniauth.com"
      },
      "license": {
          "name": "MIT",
          "url": "https://opensource.org/licenses/MIT"
      },
      "version": "1.0"
  },
  "host": "localhost:9090",
  "basePath": "/api/v1",
  "paths": {
      "/api/v1/admin/abstract-groups": {
          "get": {
              "description": "获取系统中所有的抽象组列表",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "abstract-groups"
              ],
              "summary": "获取所有抽象组",
              "responses": {
                  "200": {
                      "description": "获取成功",
                      "schema": {
                          "type": "array",
                          "items": {
                              "$ref": "#/definitions/model.AbstractGroup"
                          }
                      }
                  },
                  "500": {
                      "description": "服务器内部错误",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          },
          "post": {
              "description": "创建新的抽象组",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "abstract-groups"
              ],
              "summary": "创建抽象组",
              "parameters": [
                  {
                      "description": "抽象组创建请求",
                      "name": "request",
                      "in": "body",
                      "required": true,
                      "schema": {
                          "type": "object"
                      }
                  }
              ],
              "responses": {
                  "201": {
                      "description": "创建成功",
                      "schema": {
                          "$ref": "#/definitions/model.AbstractGroup"
                      }
                  },
                  "400": {
                      "description": "请求参数错误",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "500": {
                      "description": "服务器内部错误",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/admin/abstract-groups/{id}": {
          "get": {
              "description": "根据ID获取抽象组详情",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "abstract-groups"
              ],
              "summary": "获取单个抽象组",
              "parameters": [
                  {
                      "type": "string",
                      "description": "抽象组ID",
                      "name": "id",
                      "in": "path",
                      "required": true
                  }
              ],
              "responses": {
                  "200": {
                      "description": "获取成功",
                      "schema": {
                          "$ref": "#/definitions/model.AbstractGroup"
                      }
                  },
                  "500": {
                      "description": "服务器内部错误",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/admin/audit/logs": {
          "get": {
              "description": "获取系统的审计历史记录，支持分页和过滤",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "audit-management"
              ],
              "summary": "获取审计历史",
              "parameters": [
                  {
                      "type": "integer",
                      "default": 30,
                      "description": "查询天数",
                      "name": "days",
                      "in": "query"
                  },
                  {
                      "type": "integer",
                      "default": 1,
                      "description": "页码",
                      "name": "page",
                      "in": "query"
                  },
                  {
                      "type": "integer",
                      "default": 50,
                      "description": "每页大小",
                      "name": "pageSize",
                      "in": "query"
                  },
                  {
                      "type": "string",
                      "description": "用户过滤",
                      "name": "user",
                      "in": "query"
                  },
                  {
                      "type": "string",
                      "description": "操作类型过滤",
                      "name": "action",
                      "in": "query"
                  }
              ],
              "responses": {
                  "200": {
                      "description": "审计日志列表",
                      "schema": {
                          "type": "array",
                          "items": {
                              "$ref": "#/definitions/handler.AuditLogEntry"
                          }
                      }
                  },
                  "500": {
                      "description": "服务器内部错误",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/admin/chat-categories/{id}": {
          "put": {
              "description": "更新用户组（对话类别）信息",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "billing-management"
              ],
              "summary": "更新对话类别",
              "parameters": [
                  {
                      "type": "string",
                      "description": "对话类别ID",
                      "name": "id",
                      "in": "path",
                      "required": true
                  },
                  {
                      "description": "更新请求",
                      "name": "request",
                      "in": "body",
                      "required": true,
                      "schema": {
                          "type": "object"
                      }
                  }
              ],
              "responses": {
                  "200": {
                      "description": "更新成功",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "400": {
                      "description": "请求参数错误",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "500": {
                      "description": "更新失败",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/admin/rules": {
          "get": {
              "description": "获取系统中的所有规则，支持分页和搜索",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "rules-management"
              ],
              "summary": "获取所有规则",
              "parameters": [
                  {
                      "type": "integer",
                      "default": 1,
                      "description": "页码",
                      "name": "page",
                      "in": "query"
                  },
                  {
                      "type": "integer",
                      "default": 50,
                      "description": "每页大小",
                      "name": "pageSize",
                      "in": "query"
                  },
                  {
                      "type": "string",
                      "description": "搜索关键词",
                      "name": "search",
                      "in": "query"
                  },
                  {
                      "enum": [
                          "policy",
                          "role"
                      ],
                      "type": "string",
                      "description": "规则类型",
                      "name": "type",
                      "in": "query"
                  }
              ],
              "responses": {
                  "200": {
                      "description": "规则列表",
                      "schema": {
                          "type": "array",
                          "items": {
                              "$ref": "#/definitions/handler.Rule"
                          }
                      }
                  },
                  "500": {
                      "description": "服务器内部错误",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/admin/toggle-permission": {
          "post": {
              "description": "临时禁用或启用用户的特定权限",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "permission-management"
              ],
              "summary": "临时禁用/启用权限",
              "parameters": [
                  {
                      "description": "权限切换请求",
                      "name": "request",
                      "in": "body",
                      "required": true,
                      "schema": {
                          "type": "object"
                      }
                  }
              ],
              "responses": {
                  "200": {
                      "description": "权限切换结果",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "400": {
                      "description": "请求参数错误",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/admin/user/{upn}/permissions": {
          "get": {
              "description": "获取指定用户的完整权限树结构",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "user-management"
              ],
              "summary": "获取用户权限树",
              "parameters": [
                  {
                      "type": "string",
                      "description": "用户UPN",
                      "name": "upn",
                      "in": "path",
                      "required": true
                  }
              ],
              "responses": {
                  "200": {
                      "description": "用户权限树",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "400": {
                      "description": "请求参数错误",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/auth/check": {
          "post": {
              "description": "检查用户对指定资源的权限，支持API Key和智能权限继承",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "permission-management"
              ],
              "summary": "权限检查",
              "parameters": [
                  {
                      "description": "权限检查请求",
                      "name": "request",
                      "in": "body",
                      "required": true,
                      "schema": {
                          "type": "object"
                      }
                  }
              ],
              "responses": {
                  "200": {
                      "description": "权限检查结果",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "400": {
                      "description": "请求参数错误",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/chat/bill": {
          "post": {
              "description": "对指定用户进行计费扣款",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "billing-management"
              ],
              "summary": "计费",
              "parameters": [
                  {
                      "description": "计费请求",
                      "name": "request",
                      "in": "body",
                      "required": true,
                      "schema": {
                          "$ref": "#/definitions/handler.BillRequest"
                      }
                  }
              ],
              "responses": {
                  "200": {
                      "description": "计费成功",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "400": {
                      "description": "请求参数错误",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "500": {
                      "description": "计费失败",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/chat/ensure-account": {
          "post": {
              "description": "确保用户的聊天账户存在，如果不存在则创建",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "billing-management"
              ],
              "summary": "确保聊天账户存在",
              "parameters": [
                  {
                      "description": "确保账户存在请求",
                      "name": "request",
                      "in": "body",
                      "required": true,
                      "schema": {
                          "$ref": "#/definitions/handler.EnsureChatAccountExistsRequest"
                      }
                  }
              ],
              "responses": {
                  "200": {
                      "description": "账户已存在或创建成功",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "400": {
                      "description": "请求参数错误",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "500": {
                      "description": "创建账户失败",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      },
      "/api/v1/chat/reset-balance": {
          "post": {
              "description": "重置指定用户的余额",
              "consumes": [
                  "application/json"
              ],
              "produces": [
                  "application/json"
              ],
              "tags": [
                  "billing-management"
              ],
              "summary": "重置余额",
              "parameters": [
                  {
                      "description": "重置余额请求",
                      "name": "request",
                      "in": "body",
                      "required": true,
                      "schema": {
                          "$ref": "#/definitions/handler.ResetBalanceRequest"
                      }
                  }
              ],
              "responses": {
                  "200": {
                      "description": "重置成功",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "400": {
                      "description": "请求参数错误",
                      "schema": {
                          "type": "object"
                      }
                  },
                  "500": {
                      "description": "重置失败",
                      "schema": {
                          "type": "object"
                      }
                  }
              }
          }
      }
  },
  "definitions": {
      "handler.AuditLogEntry": {
          "description": "审计日志条目",
          "type": "object",
          "properties": {
              "action": {
                  "description": "操作",
                  "type": "string",
                  "example": "create"
              },
              "createdAt": {
                  "description": "创建时间",
                  "type": "string",
                  "example": "2024-01-01T12:00:00Z"
              },
              "details": {
                  "description": "详细信息（JSON字符串）",
                  "type": "string",
                  "example": "{\"field\":\"value\"}"
              },
              "id": {
                  "description": "主键ID",
                  "type": "integer",
                  "example": 1
              },
              "ipAddress": {
                  "description": "IP地址",
                  "type": "string",
                  "example": "192.168.1.1"
              },
              "resource": {
                  "description": "资源",
                  "type": "string",
                  "example": "rule"
              },
              "success": {
                  "description": "是否成功",
                  "type": "boolean",
                  "example": true
              },
              "timestamp": {
                  "description": "时间戳",
                  "type": "string",
                  "example": "2024-01-01T12:00:00Z"
              },
              "user": {
                  "description": "用户",
                  "type": "string",
                  "example": "admin@example.com"
              },
              "userAgent": {
                  "description": "用户代理",
                  "type": "string",
                  "example": "Mozilla/5.0..."
              }
          }
      },
      "handler.BillRequest": {
          "description": "计费请求结构",
          "type": "object",
          "required": [
              "cost",
              "model",
              "tokens",
              "upn"
          ],
          "properties": {
              "cost": {
                  "description": "费用（字符串格式）",
                  "type": "string",
                  "example": "0.10"
              },
              "model": {
                  "description": "使用的模型",
                  "type": "string",
                  "example": "gpt-4"
              },
              "tokens": {
                  "description": "消耗的token数量",
                  "type": "integer",
                  "example": 1000
              },
              "upn": {
                  "description": "用户UPN",
                  "type": "string",
                  "example": "user@example.com"
              }
          }
      },
      "handler.EnsureChatAccountExistsRequest": {
          "description": "确保聊天账户存在请求结构",
          "type": "object",
          "required": [
              "upn"
          ],
          "properties": {
              "upn": {
                  "description": "用户UPN",
                  "type": "string",
                  "example": "user@example.com"
              }
          }
      },
      "handler.ResetBalanceRequest": {
          "description": "重置余额请求结构",
          "type": "object",
          "required": [
              "upn"
          ],
          "properties": {
              "reset_anyway": {
                  "description": "是否强制重置",
                  "type": "boolean",
                  "example": false
              },
              "upn": {
                  "description": "用户UPN",
                  "type": "string",
                  "example": "user@example.com"
              }
          }
      },
      "handler.Rule": {
          "description": "规则结构",
          "type": "object",
          "properties": {
              "action": {
                  "description": "动作",
                  "type": "string",
                  "example": "use"
              },
              "createdAt": {
                  "description": "创建时间",
                  "type": "string",
                  "example": "2024-01-01 12:00:00"
              },
              "domain": {
                  "description": "资源域",
                  "type": "string",
                  "example": "models"
              },
              "effect": {
                  "description": "效果：allow/deny",
                  "type": "string",
                  "example": "allow"
              },
              "id": {
                  "description": "规则ID",
                  "type": "string",
                  "example": "p_1"
              },
              "isActive": {
                  "description": "是否启用",
                  "type": "boolean",
                  "example": true
              },
              "object": {
                  "description": "资源对象",
                  "type": "string",
                  "example": "gpt-4"
              },
              "role": {
                  "description": "角色（仅用于role类型）",
                  "type": "string",
                  "example": "admin"
              },
              "source": {
                  "description": "来源：\"database\" 或 \"csv\"",
                  "type": "string",
                  "example": "database"
              },
              "subject": {
                  "description": "用户或组",
                  "type": "string",
                  "example": "user@example.com"
              },
              "type": {
                  "description": "规则类型：\"policy\" 或 \"role\"",
                  "type": "string",
                  "example": "policy"
              },
              "updatedAt": {
                  "description": "更新时间",
                  "type": "string",
                  "example": "2024-01-01 12:00:00"
              }
          }
      },
      "model.AbstractGroup": {
          "description": "抽象组数据库模型",
          "type": "object",
          "properties": {
              "createdAt": {
                  "description": "创建时间",
                  "type": "string"
              },
              "creatorUpn": {
                  "description": "创建者UPN",
                  "type": "string",
                  "example": "admin@example.com"
              },
              "deletedAt": {
                  "description": "删除时间（软删除）",
                  "type": "string"
              },
              "description": {
                  "description": "抽象组描述",
                  "type": "string",
                  "example": "管理员组"
              },
              "id": {
                  "description": "主键ID",
                  "type": "integer",
                  "example": 1
              },
              "name": {
                  "description": "抽象组名称",
                  "type": "string",
                  "example": "admin_group"
              },
              "rule": {
                  "description": "抽象组规则",
                  "allOf": [
                      {
                          "$ref": "#/definitions/model.AbstractGroupRule"
                      }
                  ]
              },
              "type": {
                  "description": "抽象组类型：\"ittools\" 或 \"manual\"",
                  "type": "string",
                  "example": "ittools"
              },
              "updatedAt": {
                  "description": "更新时间",
                  "type": "string"
              }
          }
      },
      "model.AbstractGroupRule": {
          "description": "抽象组抽象规则",
          "type": "object",
          "properties": {
              "ittools": {
                  "description": "ITTools 类型规则",
                  "allOf": [
                      {
                          "$ref": "#/definitions/model.IttoolsRule"
                      }
                  ]
              },
              "manual": {
                  "description": "手动类型规则",
                  "allOf": [
                      {
                          "$ref": "#/definitions/model.ManualRule"
                      }
                  ]
              }
          }
      },
      "model.Condition": {
          "description": "ITTools 类型规则组中的单个条件",
          "type": "object",
          "properties": {
              "field": {
                  "description": "字段名",
                  "type": "string",
                  "example": "department"
              },
              "operator": {
                  "description": "操作符",
                  "type": "string",
                  "example": "equals"
              },
              "value": {
                  "description": "字段值",
                  "type": "string",
                  "example": "IT"
              }
          }
      },
      "model.IttoolsRule": {
          "description": "ITTools 类型规则",
          "type": "object",
          "properties": {
              "conditions": {
                  "description": "条件列表",
                  "type": "array",
                  "items": {
                      "$ref": "#/definitions/model.Condition"
                  }
              },
              "logical_operator": {
                  "description": "逻辑操作符：\"AND\" 或 \"OR\"",
                  "type": "string",
                  "example": "AND"
              }
          }
      },
      "model.ManualRule": {
          "description": "手动类型规则",
          "type": "object",
          "properties": {
              "upns": {
                  "description": "用户UPN列表",
                  "type": "array",
                  "items": {
                      "type": "string"
                  },
                  "example": [
                      "user1@example.com",
                      "user2@example.com"
                  ]
              }
          }
      }
  }
}