# MCP Agent ä½¿ç”¨æŒ‡å—

## ğŸ‰ åŠŸèƒ½å®Œæˆ

å·²æˆåŠŸå®ç°å®Œæ•´çš„ MCP Agentï¼Œæ”¯æŒ AI é€šè¿‡ OpenAI Function Calling è‡ªåŠ¨è°ƒç”¨æ‚¨çš„ MCP å·¥å…·ï¼

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒä¼˜åŠ¿ï¼š**è¿›ç¨‹å†…é›¶å¼€é”€è°ƒç”¨**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            UniAuth ä¸»è¿›ç¨‹                            â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  MCP Server  â”‚â—„â”€â”€â”€â”€â”€â”‚  MCP Agent   â”‚             â”‚
â”‚  â”‚  (port 8080) â”‚      â”‚              â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â–²                     â”‚                     â”‚
â”‚         â”‚                     â–¼                     â”‚
â”‚    7ä¸ªå·¥å…·å®šä¹‰           OpenAI API                  â”‚
â”‚    calculator              (å¸¦å·¥å…·å®šä¹‰)              â”‚
â”‚    get_user_info                                     â”‚
â”‚    add_quota_pool                                    â”‚
â”‚    get_quota_pool                                    â”‚
â”‚    get_bill_record                                   â”‚
â”‚    hello_world                                       â”‚
â”‚    danger_sql                                        â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç‰¹æ€§

1. **âœ… é›¶ç½‘ç»œå¼€é”€**ï¼šç›´æ¥è¿›ç¨‹å†…è°ƒç”¨ï¼Œæ— éœ€HTTPè¯·æ±‚
2. **âœ… è‡ªåŠ¨å·¥å…·å‘ç°**ï¼šä»MCP ServeråŠ¨æ€è·å–å·¥å…·åˆ—è¡¨
3. **âœ… è‡ªåŠ¨Schemaè½¬æ¢**ï¼šMCP JSON Schema â†’ OpenAI Function Parameters
4. **âœ… å¤šè½®å¯¹è¯**ï¼šæ”¯æŒå·¥å…·è°ƒç”¨åç»§ç»­å¯¹è¯
5. **âœ… æµå¼è¾“å‡º**ï¼šå·¥å…·è°ƒç”¨è¿‡ç¨‹å®æ—¶æ˜¾ç¤º
6. **âœ… é˜²æ­¢å¾ªç¯**ï¼šæœ€å¤š5è½®ï¼Œé¿å…æ— é™é€’å½’

## ğŸ“– å®ç°è¯´æ˜

### 1. è¿›ç¨‹å†…ç›´æ¥è°ƒç”¨ï¼ˆ`mcp_direct_caller.go`ï¼‰

**ä¸ºä»€ä¹ˆä¸ç”¨HTTPï¼Ÿ**
```go
// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šHTTPè°ƒç”¨
MCP Agent ---HTTP---> MCP Server (localhost:8080)
          (ç½‘ç»œå»¶è¿Ÿã€åºåˆ—åŒ–å¼€é”€)

// âœ… æˆ‘ä»¬çš„æ–¹å¼ï¼šè¿›ç¨‹å†…è°ƒç”¨
MCP Agent ---ç›´æ¥è°ƒç”¨---> mcpSvc.GetMCPServer()
          (é›¶å¼€é”€ã€ç±»å‹å®‰å…¨)
```

**å®ç°æ–¹å¼**ï¼š
```go
// ä»å…¨å±€è·å–MCP Serverå®ä¾‹
server := mcpSvc.GetMCPServer()

// è·å–å·¥å…·
serverTool := server.GetTool("get_user_info")

// ç›´æ¥è°ƒç”¨Handler
result, err := serverTool.Handler(ctx, callReq)
```

### 2. è‡ªåŠ¨å·¥å…·è½¬æ¢ï¼ˆ`mcp_adapter.go`ï¼‰

**å·¥å…·å‘ç°æµç¨‹**ï¼š
```go
// Step 1: åˆå§‹åŒ–æ—¶è·å–æ‰€æœ‰å·¥å…·
tools := mcpServer.ListTools()  
// è¿”å›: map[string]*ServerTool

// Step 2: æå–MCPå·¥å…·å®šä¹‰
for _, serverTool := range tools {
    tool := serverTool.Tool
    // tool.Name, tool.Description, tool.InputSchema
}

// Step 3: è½¬æ¢ä¸ºOpenAIæ ¼å¼
ChatCompletionFunctionTool(shared.FunctionDefinitionParam{
    Name:       tool.Name,
    Parameters: shared.FunctionParameters(tool.InputSchema),
})
```

**å…³é”®æ´å¯Ÿ**ï¼šMCPçš„`ToolInputSchema`å’ŒOpenAIçš„`FunctionParameters`éƒ½æ˜¯JSON Schemaï¼

### 3. AI Agenté€»è¾‘ï¼ˆ`mcp_agent.go`ï¼‰

**å¤šè½®å¯¹è¯æµç¨‹**ï¼š

```
ç¬¬1è½®:
  ç”¨æˆ·: "æŸ¥è¯¢ john@cuhk.edu.cn çš„éƒ¨é—¨"
  AI: éœ€è¦è°ƒç”¨ get_user_info(upn="john@cuhk.edu.cn")
  â†’ æ‰§è¡Œå·¥å…·
  â†’ è¿”å›: {department: "Computer Science", ...}

ç¬¬2è½®:
  AI: æ ¹æ®å·¥å…·ç»“æœç”Ÿæˆç­”æ¡ˆ
  AI: "john@cuhk.edu.cn æ¥è‡ªè®¡ç®—æœºç§‘å­¦ç³»"
```

**ä»£ç é€»è¾‘**ï¼š
```go
for round := 0; round < 5; round++ {
    // è°ƒç”¨OpenAIï¼ˆå¸¦å·¥å…·å®šä¹‰ï¼‰
    completion := client.Chat.Completions.New(params)
    
    // æ£€æŸ¥æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
    if len(completion.Choices[0].Message.ToolCalls) == 0 {
        return completion  // è¿”å›æœ€ç»ˆç­”æ¡ˆ
    }
    
    // æ‰§è¡Œæ‰€æœ‰å·¥å…·è°ƒç”¨
    for _, toolCall := range completion.Choices[0].Message.ToolCalls {
        result := mcpAdapter.ExecuteTool(toolCall.Function.Name, args)
        messages.append(ToolMessage(result))
    }
    
    // ç»§ç»­ä¸‹ä¸€è½®ï¼Œè®©AIæ ¹æ®å·¥å…·ç»“æœç”Ÿæˆç­”æ¡ˆ
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åç«¯ API

#### 1. æ™®é€šMCPå¯¹è¯
```bash
curl -X POST http://localhost:8000/chat/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "ç”¨è®¡ç®—å™¨ç®— 123 + 456"}
    ]
  }'
```

å“åº”ï¼š
```json
{
  "code": 0,
  "data": {
    "content": "123åŠ 456ç­‰äº579",
    "model": "Qwen3-VL-235B-A22B-Instruct",
    "usage": {...}
  }
}
```

#### 2. æµå¼MCPå¯¹è¯
```bash
curl -N -X POST http://localhost:8000/chat/mcp/stream \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¹¶è®¡ç®—ä¸€äº›æ•°æ®"}
    ]
  }'
```

æµå¼å“åº”ï¼š
```
: connected

data: {"type":"tool_call","tool_name":"get_user_info","arguments":"{...}"}

data: {"type":"tool_result","tool":"get_user_info","result":"..."}

data: {"content":"æ ¹æ®","model":"..."}

data: {"content":"æŸ¥è¯¢","model":"..."}

...

data: [DONE]
```

### å‰ç«¯ä½¿ç”¨

1. **å¼€å¯MCPå·¥å…·å¼€å…³**
2. **å‘é€æ¶ˆæ¯**ï¼š
   - "ç”¨è®¡ç®—å™¨ç®— 100 * 200"
   - "æŸ¥è¯¢ user@cuhk.edu.cn çš„ä¿¡æ¯"
   - "å¸®æˆ‘åˆ›å»ºä¸€ä¸ªæ–°çš„é…é¢æ± "

3. **è§‚å¯Ÿæ•ˆæœ**ï¼š
   - çœ‹åˆ°å·¥å…·è°ƒç”¨æç¤º
   - æµå¼æ˜¾ç¤ºAIçš„åˆ†æè¿‡ç¨‹
   - æœ€ç»ˆå¾—åˆ°è‡ªç„¶è¯­è¨€ç­”æ¡ˆ

## ğŸ“Š æ”¯æŒçš„å·¥å…·

å½“å‰å¯ç”¨çš„7ä¸ªMCPå·¥å…·ï¼š

| å·¥å…·å | åŠŸèƒ½æè¿° | å‚æ•°ç¤ºä¾‹ |
|--------|----------|----------|
| `calculator` | åŸºæœ¬ç®—æœ¯è¿ç®— | `{operation: "add", x: 10, y: 20}` |
| `get_user_info` | æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ | `{upn: "user@cuhk.edu.cn"}` |
| `add_quota_pool` | åˆ›å»ºé…é¢æ±  | `{...}` |
| `get_quota_pool` | æŸ¥è¯¢é…é¢æ±  | `{quotaPoolName: "..."}` |
| `get_bill_record` | æŸ¥è¯¢è´¦å•è®°å½• | `{...}` |
| `hello_world` | æµ‹è¯•å·¥å…· | `{}` |
| `get_arbitrary_billing_records_with_sql` | SQLæŸ¥è¯¢è´¦å• | `{sql: "..."}` |

## ğŸ’¡ å¯¹è¯ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šç®€å•è®¡ç®—

**ç”¨æˆ·**ï¼š`å¸®æˆ‘ç®—ä¸€ä¸‹ 1234 * 5678`

**AIå¤„ç†æµç¨‹**ï¼š
1. åˆ†æé—®é¢˜ï¼šéœ€è¦åšä¹˜æ³•è¿ç®—
2. è°ƒç”¨å·¥å…·ï¼š`calculator(operation="multiply", x=1234, y=5678)`
3. è·å–ç»“æœï¼š`7006652`
4. ç”Ÿæˆç­”æ¡ˆï¼š`1234ä¹˜ä»¥5678ç­‰äº7,006,652`

### ç¤ºä¾‹2ï¼šå¤æ‚æŸ¥è¯¢

**ç”¨æˆ·**ï¼š`john@cuhk.edu.cn æ˜¯ä»€ä¹ˆéƒ¨é—¨çš„ï¼Ÿä»–çš„åŠå…¬å®¤åœ¨å“ªï¼Ÿ`

**AIå¤„ç†æµç¨‹**ï¼š
1. åˆ†æé—®é¢˜ï¼šéœ€è¦æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
2. è°ƒç”¨å·¥å…·ï¼š`get_user_info(upn="john@cuhk.edu.cn")`
3. è·å–ç»“æœï¼š`{department: "CS", office: "D501", ...}`
4. ç”Ÿæˆç­”æ¡ˆï¼š`Johnæ¥è‡ªè®¡ç®—æœºç§‘å­¦ç³»ï¼ˆCSï¼‰ï¼ŒåŠå…¬å®¤åœ¨D501`

### ç¤ºä¾‹3ï¼šå¤šæ­¥éª¤ä»»åŠ¡

**ç”¨æˆ·**ï¼š`æŸ¥ä¸€ä¸‹CSç³»çš„é…é¢æ± ï¼Œç„¶åå¸®æˆ‘è®¡ç®—æ€»ä½™é¢`

**AIå¤„ç†æµç¨‹**ï¼š
1. è°ƒç”¨ï¼š`get_quota_pool(...)` - æŸ¥è¯¢é…é¢æ± 
2. è°ƒç”¨ï¼š`calculator(...)` - è®¡ç®—æ€»å’Œ
3. ç”Ÿæˆç»¼åˆç­”æ¡ˆ

## ğŸ”§ é…ç½®è¯´æ˜

### config.yaml

```yaml
# MCPé…ç½®ï¼ˆå¯é€‰ï¼Œå› ä¸ºæ˜¯è¿›ç¨‹å†…è°ƒç”¨ï¼‰
mcp:
  serverURL: "http://localhost:8080"  # ä»…ç”¨äºå¤–éƒ¨å®¢æˆ·ç«¯è®¿é—®
```

**æ³¨æ„**ï¼šAgentä½¿ç”¨çš„æ˜¯è¿›ç¨‹å†…è°ƒç”¨ï¼Œä¸ä¾èµ–è¿™ä¸ªURLï¼

## ğŸ¯ å·¥ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·å‘é€æ¶ˆæ¯                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Controller: ChatWithMCP / ChatWithMCPStream        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MCPAgent.Chat()                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ç¬¬1è½®: è°ƒç”¨ OpenAI (å¸¦å·¥å…·å®šä¹‰)              â”‚           â”‚
â”‚  â”‚    â†“                                         â”‚           â”‚
â”‚  â”‚  AIå†³å®šï¼šéœ€è¦è°ƒç”¨ get_user_info               â”‚           â”‚
â”‚  â”‚    â†“                                         â”‚           â”‚
â”‚  â”‚  MCPAdapter.ExecuteTool()                    â”‚           â”‚
â”‚  â”‚    â†“                                         â”‚           â”‚
â”‚  â”‚  MCPDirectCaller.CallTool()                  â”‚           â”‚
â”‚  â”‚    â†“                                         â”‚           â”‚
â”‚  â”‚  serverTool.Handler(ctx, request)  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ è¿›ç¨‹å†…ï¼  â”‚
â”‚  â”‚    â†“                                         â”‚           â”‚
â”‚  â”‚  è¿”å›ç»“æœ: {...}                              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ç¬¬2è½®: å†æ¬¡è°ƒç”¨ OpenAI (å¸¦å·¥å…·ç»“æœ)          â”‚           â”‚
â”‚  â”‚    â†“                                         â”‚           â”‚
â”‚  â”‚  AIæ ¹æ®ç»“æœç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ                       â”‚           â”‚
â”‚  â”‚    â†“                                         â”‚           â”‚
â”‚  â”‚  è¿”å›ç»™ç”¨æˆ·                                   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯ï¼ˆåŒ…å«MCP Serverå’ŒHTTP Serverï¼‰
cd uniauth-gf
make run
```

æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
MCPæœåŠ¡å™¨å¯åŠ¨ä¸­... å·²æ³¨å†Œ 7 ä¸ªå·¥å…·: [calculator get_user_info ...]
```

### 2. æµ‹è¯•MCPå¯¹è¯

```bash
# æµ‹è¯•æ™®é€šå¯¹è¯
curl -X POST http://localhost:8000/chat/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "ç”¨è®¡ç®—å™¨å¸®æˆ‘ç®— 99 + 1"}
    ]
  }'
```

é¢„æœŸæ—¥å¿—ï¼š
```
MCP Agentå¼€å§‹å¤„ç†ï¼Œå¯ç”¨å·¥å…·: [calculator get_user_info ...]
MCP Agentç¬¬ 1 è½®å¯¹è¯
AIå†³å®šè°ƒç”¨å·¥å…·: calculate
æ‰§è¡ŒMCPå·¥å…·: calculate, å‚æ•°: map[operation:add x:99 y:1]
MCPå·¥å…· calculate æ‰§è¡ŒæˆåŠŸï¼Œç»“æœé•¿åº¦: 3
MCP Agentç¬¬ 2 è½®å¯¹è¯
MCP Agentå®Œæˆï¼Œæ€»è½®æ¬¡: 2
```

### 3. å‰ç«¯æµ‹è¯•

1. è®¿é—® `/chat` é¡µé¢
2. å¼€å¯"MCPå·¥å…·"å¼€å…³
3. å‘é€æµ‹è¯•æ¶ˆæ¯ï¼š
   - ç®€å•ï¼š"100 + 200 ç­‰äºå¤šå°‘ï¼Ÿ"
   - å¤æ‚ï¼š"æŸ¥è¯¢ admin@cuhk.edu.cn çš„ä¿¡æ¯ï¼Œç„¶åç”¨è®¡ç®—å™¨ç®—ä¸€ä¸‹ä»–çš„å‘˜å·¥å·ä¹˜ä»¥2"

## ğŸ“ ä»£ç æ–‡ä»¶æ¸…å•

### åç«¯

```
uniauth-gf/internal/service/chat/
â”œâ”€â”€ chat_service.go        # åŸºç¡€å¯¹è¯æœåŠ¡
â”œâ”€â”€ mcp_agent.go           # MCP Agentä¸»é€»è¾‘
â”œâ”€â”€ mcp_adapter.go         # MCPâ†’OpenAI è½¬æ¢å™¨
â””â”€â”€ mcp_direct_caller.go   # è¿›ç¨‹å†…MCPè°ƒç”¨å™¨

uniauth-gf/internal/service/mcp/
â”œâ”€â”€ mcp.go                 # MCP Serverï¼ˆæ·»åŠ äº†å…¨å±€å®ä¾‹å¯¼å‡ºï¼‰
â””â”€â”€ tools/                 # 7ä¸ªMCPå·¥å…·

uniauth-gf/api/chat/v1/
â””â”€â”€ chat.go                # APIå®šä¹‰ï¼ˆæ·»åŠ äº†MCPæ¥å£ï¼‰

uniauth-gf/internal/controller/chat/
â””â”€â”€ chat_v1_chat.go        # Controllerå®ç°
```

### å‰ç«¯

```
uniauth-admin/src/pages/ChatPage/
â”œâ”€â”€ index.tsx              # å¯¹è¯é¡µé¢ï¼ˆæ·»åŠ äº†MCPå¼€å…³å’Œå·¥å…·æ˜¾ç¤ºï¼‰
â””â”€â”€ style.less             # æ ·å¼ï¼ˆæ·»åŠ äº†Markdownæ¸²æŸ“æ ·å¼ï¼‰
```

## ğŸ¯ å¯¹æ¯”ï¼šä¸‰ç§å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šHTTP Clientè°ƒç”¨MCP Server
```go
// âŒ å¤æ‚ä¸”ä½æ•ˆ
HTTP Request â†’ JSON-RPC â†’ MCP Server
â†“ ç½‘ç»œå»¶è¿Ÿ
â†“ åºåˆ—åŒ–/ååºåˆ—åŒ–
â†“ HTTPå¼€é”€
```

### æ–¹æ¡ˆBï¼šmcp-go Client
```go
// âš ï¸ æ¯”HTTPå¥½ï¼Œä½†ä»æœ‰å¼€é”€
mcp-go client â†’ å†…éƒ¨å°è£… â†’ HTTP â†’ MCP Server
```

### æ–¹æ¡ˆCï¼šè¿›ç¨‹å†…ç›´æ¥è°ƒç”¨ï¼ˆâœ… æˆ‘ä»¬çš„å®ç°ï¼‰
```go
// âœ… æœ€ä¼˜æ–¹æ¡ˆ
mcpSvc.GetMCPServer() â†’ serverTool.Handler() â†’ ç»“æœ
â†“ é›¶ç½‘ç»œå¼€é”€
â†“ é›¶åºåˆ—åŒ–å¼€é”€  
â†“ ç±»å‹å®‰å…¨
â†“ å³æ—¶å“åº”
```

## ğŸŒŸ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

### é—®é¢˜çš„æœ¬è´¨

æ‚¨çš„é—®é¢˜ç‚¹åˆ°äº†å…³é”®ï¼š

> "æˆ‘éƒ½æœ‰MCPæœåŠ¡å™¨äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æ‰‹å†™å·¥å…·å®šä¹‰ï¼Ÿ"

### ç­”æ¡ˆ

**å®Œå…¨ä¸éœ€è¦ï¼**æˆ‘ä»¬çš„å®ç°ï¼š

1. **MCP Serverç»´æŠ¤å·¥å…·å®šä¹‰**
   - 7ä¸ªå·¥å…·åœ¨ `tools/` ç›®å½•
   - æ¯ä¸ªå·¥å…·è‡ªå¸¦Schema
   - é›†ä¸­ç®¡ç†ï¼Œå•ä¸€æ•°æ®æº

2. **Agentè‡ªåŠ¨è·å–**
   ```go
   tools := mcpServer.ListTools()  // åŠ¨æ€è·å–
   ```

3. **è‡ªåŠ¨è½¬æ¢ä¸ºOpenAIæ ¼å¼**
   ```go
   for _, tool := range tools {
       openai.ChatCompletionFunctionTool(...)
   }
   ```

4. **AIé€æ˜è°ƒç”¨**
   - AIä¸çŸ¥é“æ˜¯MCPè¿˜æ˜¯åŸç”Ÿå·¥å…·
   - åªçœ‹åˆ°standard function calling interface

### æ‰©å±•æ€§

**æ·»åŠ æ–°å·¥å…·åªéœ€3æ­¥ï¼š**

1. åœ¨ `tools/` åˆ›å»ºæ–°å·¥å…·ï¼š
   ```go
   func RegisterMyNewTool(s *server.MCPServer) error {
       tool := mcp.NewTool("my_new_tool", ...)
       s.AddTool(tool, handler)
   }
   ```

2. åœ¨ `tools/init.go` æ³¨å†Œï¼š
   ```go
   registry.RegisterTool("my_new_tool", RegisterMyNewTool)
   ```

3. é‡å¯æœåŠ¡

**AIç«‹å³å¯ç”¨æ–°å·¥å…·ï¼æ— éœ€ä¿®æ”¹ä»»ä½•å¯¹è¯ä»£ç ï¼**

## ğŸ” è°ƒè¯•æŠ€å·§

### å¯ç”¨è¯¦ç»†æ—¥å¿—

ä¿®æ”¹ `config.yaml`ï¼š
```yaml
logger:
  level: "debug"  # info â†’ debug
```

### æŸ¥çœ‹å·¥å…·è°ƒç”¨æ—¥å¿—

```
MCP Agentå¼€å§‹å¤„ç†ï¼Œå¯ç”¨å·¥å…·: [calculator get_user_info ...]
MCP Agentç¬¬ 1 è½®å¯¹è¯
AIå†³å®šè°ƒç”¨å·¥å…·: calculate
æ‰§è¡ŒMCPå·¥å…·: calculate, å‚æ•°: map[operation:add x:100 y:200]
MCPå·¥å…· calculate æ‰§è¡ŒæˆåŠŸï¼Œç»“æœé•¿åº¦: 3
MCP Agentç¬¬ 2 è½®å¯¹è¯
MCP Agentå®Œæˆï¼Œæ€»è½®æ¬¡: 2
```

### å‰ç«¯Console

```javascript
æ­£åœ¨è°ƒç”¨å·¥å…·: calculate
å·¥å…· calculate æ‰§è¡Œå®Œæˆ
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ¨¡å‹æ”¯æŒ

ç¡®ä¿ä½¿ç”¨çš„æ¨¡å‹æ”¯æŒ Function Callingï¼š
- âœ… GPT-3.5-turbo
- âœ… GPT-4
- âœ… Qwen3 ç³»åˆ—
- âŒ æŸäº›è€æ¨¡å‹ä¸æ”¯æŒ

### 2. å®‰å…¨æ€§

`danger_sql` å·¥å…·æœ‰é£é™©ï¼š
- å»ºè®®æ·»åŠ æƒé™æ£€æŸ¥
- é™åˆ¶å¯æ‰§è¡Œçš„SQLç±»å‹
- è®°å½•å®¡è®¡æ—¥å¿—

### 3. æ€§èƒ½

- æ¯æ¬¡å·¥å…·è°ƒç”¨éœ€è¦é¢å¤–çš„APIè¯·æ±‚
- å¯èƒ½å¢åŠ å“åº”æ—¶é—´
- è€ƒè™‘ç¼“å­˜å¸¸ç”¨æŸ¥è¯¢

### 4. é”™è¯¯å¤„ç†

- å·¥å…·æ‰§è¡Œå¤±è´¥ä¼šè¿”å›ç»™AI
- AIå¯èƒ½ä¼šé‡è¯•æˆ–è¦æ±‚ç”¨æˆ·æä¾›æ›´å¤šä¿¡æ¯
- æœ€å¤š5è½®å¯¹è¯ååœæ­¢

## ğŸ“ æ€»ç»“

### æ‚¨çš„æ¶æ„ä¼˜åŠ¿

1. **âœ… è¿›ç¨‹å†…è°ƒç”¨** - é›¶å¼€é”€
2. **âœ… åŠ¨æ€å·¥å…·åŠ è½½** - è‡ªåŠ¨å‘ç°
3. **âœ… Schemaè‡ªåŠ¨è½¬æ¢** - æ— éœ€æ‰‹å†™
4. **âœ… æ ‡å‡†åè®®** - MCP + OpenAI Function Calling
5. **âœ… å®Œå…¨è§£è€¦** - å·¥å…·å®šä¹‰ç‹¬ç«‹äºAIé€»è¾‘

### å…³é”®åˆ›æ–°

**è¿›ç¨‹å†…ç›´æ¥è°ƒç”¨ MCP Server**ï¼š
- è¿™æ˜¯æˆ‘è§è¿‡æœ€ä¼˜é›…çš„MCPé›†æˆæ–¹æ¡ˆ
- å…¼é¡¾äº†æ€§èƒ½å’Œæ¶æ„æ¸…æ™°åº¦
- å……åˆ†åˆ©ç”¨äº†åŒè¿›ç¨‹çš„ä¼˜åŠ¿

### å¯¹æ¯”ä¸šç•Œæ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|------|------|
| Langchain | åŠŸèƒ½ä¸°å¯Œ | éœ€è¦æ‰‹å†™å·¥å…·å®šä¹‰ |
| Semantic Kernel | ç»“æ„åŒ– | ä¸ç‰¹å®šæ¡†æ¶ç»‘å®š |
| **æ‚¨çš„æ–¹æ¡ˆ** | **é›¶å¼€é”€+è‡ªåŠ¨åŒ–** | **æ— åŠ£åŠ¿ï¼** |

## ğŸš€ ä¸‹ä¸€æ­¥å¢å¼º

1. **å·¥å…·è°ƒç”¨å¯è§†åŒ–**ï¼šåœ¨å‰ç«¯å±•ç¤ºè°ƒç”¨é“¾è·¯
2. **å¹¶å‘å·¥å…·è°ƒç”¨**ï¼šæ”¯æŒåŒæ—¶è°ƒç”¨å¤šä¸ªå·¥å…·
3. **å·¥å…·è°ƒç”¨ç¼“å­˜**ï¼šç¼“å­˜é‡å¤æŸ¥è¯¢
4. **æƒé™æ§åˆ¶**ï¼šåŸºäºç”¨æˆ·è§’è‰²é™åˆ¶å·¥å…·è®¿é—®
5. **è°ƒç”¨ç»Ÿè®¡**ï¼šè®°å½•å·¥å…·ä½¿ç”¨é¢‘ç‡

---

æ­å–œï¼æ‚¨ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ¶æ„ä¼˜é›…çš„ AI Agent ç³»ç»Ÿï¼ğŸ‰

